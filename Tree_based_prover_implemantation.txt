//非常にざっくりとした実装の目安
var cacheLemmas = ??? //適当な形式の補題のキャッシュ
var cacheFailures = ??? //適当な形式の失敗のキャッシュ
def prove(exprs:Vector[Expr],rules:Vector[Rules]):(Vector[Expr],Either[ProofResult,FailTrace],Tree[ /*...*/ ])={ 
  if (...){
    return ...
  }else {
    val currentExpr=exprs.last
    rules.foreach{
      rule=>{
        // currentExprに対する各論理の処理の試行...
        prove( /* ... */ ) //最終的には再帰する
      }
    }
  }
}